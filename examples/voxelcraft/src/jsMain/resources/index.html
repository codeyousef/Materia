<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoxelCraft - Minecraft Clone</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #87CEEB; /* Sky blue */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        #materia-canvas {
            display: block;
            width: 100vw;
            height: 100vh;
            cursor: none; /* Hide cursor when pointer locked */
        }

        /* Crosshair */
        .crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            pointer-events: none;
        }

        .crosshair::before,
        .crosshair::after {
            content: '';
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
        }

        .crosshair::before {
            left: 50%;
            top: 0;
            width: 2px;
            height: 100%;
            transform: translateX(-50%);
        }

        .crosshair::after {
            top: 50%;
            left: 0;
            width: 100%;
            height: 2px;
            transform: translateY(-50%);
        }

        /* HUD (top-left) */
        .hud {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            background: rgba(0, 0, 0, 0.7);
            padding: 12px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-family: 'Courier New', monospace;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            min-width: 220px;
        }

        .hud-row {
            margin: 3px 0;
            display: flex;
            justify-content: space-between;
        }

        .hud-label {
            color: #aaa;
        }

        .hud-value {
            color: #fff;
            font-weight: bold;
        }

        /* Inventory UI (bottom center) */
        .inventory {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 4px;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px;
            border-radius: 8px;
        }

        .inventory-slot {
            width: 50px;
            height: 50px;
            background: rgba(50, 50, 50, 0.9);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .inventory-slot:hover {
            background: rgba(80, 80, 80, 0.9);
            border-color: rgba(255, 255, 255, 0.6);
        }

        .inventory-slot.selected {
            background: rgba(100, 100, 100, 0.9);
            border-color: rgba(255, 255, 255, 1);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .inventory-slot-name {
            position: absolute;
            bottom: 2px;
            font-size: 9px;
            text-transform: uppercase;
            opacity: 0.8;
        }

        /* Controls overlay (initially visible) */
        .controls-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 30px 40px;
            border-radius: 12px;
            text-align: center;
            max-width: 500px;
            backdrop-filter: blur(10px);
        }

        .controls-overlay h2 {
            margin: 0 0 20px 0;
            color: #4fc3f7;
            font-size: 24px;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px 24px;
            margin: 20px 0;
            text-align: left;
        }

        .control-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .control-key {
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 12px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #4fc3f7;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .control-action {
            color: #ccc;
            font-size: 13px;
        }

        .start-button {
            margin-top: 20px;
            padding: 12px 32px;
            background: #4fc3f7;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .start-button:hover {
            background: #29b6f6;
            transform: scale(1.05);
        }

        /* Loading indicator - Fully opaque to hide terrain generation */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            background: #1a1a1a;
            z-index: 9999;
            cursor: pointer;
            transition: opacity 0.3s;
        }
        
        .loading:hover {
            background: #1a1a1a;
            opacity: 0.98;
        }

        .loading h2 {
            margin: 0 0 15px 0;
            color: #4fc3f7;
            font-size: 22px;
        }

        .loading-progress {
            color: #aaa;
            font-size: 14px;
            margin-top: 10px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-left: 5px solid #4fc3f7;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 15px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .hidden {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease-out;
        }
    </style>
</head>
<body>
<!-- Canvas for 3D rendering -->
<canvas id="materia-canvas"></canvas>

<!-- Crosshair -->
<div class="crosshair"></div>

<!-- HUD (top-left corner) -->
<div class="hud">
    <div class="hud-row">
        <span class="hud-label">FPS:</span>
        <span class="hud-value" id="fps">--</span>
    </div>
    <div class="hud-row">
        <span class="hud-label">Position:</span>
        <span class="hud-value" id="position">X: 0, Y: 0, Z: 0</span>
    </div>
    <div class="hud-row">
        <span class="hud-label">Flight:</span>
        <span class="hud-value" id="flight-status">OFF</span>
    </div>
    <div class="hud-row">
        <span class="hud-label">Chunks:</span>
        <span class="hud-value" id="chunks">0 / 1024</span>
    </div>
    <div class="hud-row" id="mesh-progress" style="display: none;">
        <span class="hud-label">Meshes:</span>
        <span class="hud-value" id="mesh-status">Loading...</span>
    </div>
</div>

<!-- Inventory UI (bottom center) -->
<div class="inventory">
    <div class="inventory-slot selected" data-block="grass">
        <span style="font-size: 24px;">üü©</span>
        <span class="inventory-slot-name">Grass</span>
    </div>
    <div class="inventory-slot" data-block="dirt">
        <span style="font-size: 24px;">üü´</span>
        <span class="inventory-slot-name">Dirt</span>
    </div>
    <div class="inventory-slot" data-block="stone">
        <span style="font-size: 24px;">‚¨ú</span>
        <span class="inventory-slot-name">Stone</span>
    </div>
    <div class="inventory-slot" data-block="wood">
        <span style="font-size: 24px;">üüß</span>
        <span class="inventory-slot-name">Wood</span>
    </div>
    <div class="inventory-slot" data-block="leaves">
        <span style="font-size: 24px;">üü¢</span>
        <span class="inventory-slot-name">Leaves</span>
    </div>
    <div class="inventory-slot" data-block="sand">
        <span style="font-size: 24px;">üü®</span>
        <span class="inventory-slot-name">Sand</span>
    </div>
    <div class="inventory-slot" data-block="water">
        <span style="font-size: 24px;">üü¶</span>
        <span class="inventory-slot-name">Water</span>
    </div>
</div>

<!-- Controls overlay (shown on startup) -->
<div id="controls-overlay" class="controls-overlay">
    <h2>üéÆ VoxelCraft Controls</h2>
    <div class="controls-grid">
        <div class="control-item">
            <span class="control-action">Move Forward</span>
            <span class="control-key">W</span>
        </div>
        <div class="control-item">
            <span class="control-action">Move Backward</span>
            <span class="control-key">S</span>
        </div>
        <div class="control-item">
            <span class="control-action">Move Left</span>
            <span class="control-key">A</span>
        </div>
        <div class="control-item">
            <span class="control-action">Move Right</span>
            <span class="control-key">D</span>
        </div>
        <div class="control-item">
            <span class="control-action">Look Around</span>
            <span class="control-key">Mouse</span>
        </div>
        <div class="control-item">
            <span class="control-action">Break Block</span>
            <span class="control-key">Left Click</span>
        </div>
        <div class="control-item">
            <span class="control-action">Place Block</span>
            <span class="control-key">Right Click</span>
        </div>
        <div class="control-item">
            <span class="control-action">Toggle Flight</span>
            <span class="control-key">F</span>
        </div>
        <div class="control-item">
            <span class="control-action">Fly Up</span>
            <span class="control-key">Space</span>
        </div>
        <div class="control-item">
            <span class="control-action">Fly Down</span>
            <span class="control-key">Shift</span>
        </div>
        <div class="control-item">
            <span class="control-action">Select Block</span>
            <span class="control-key">1-7</span>
        </div>
        <div class="control-item">
            <span class="control-action">Jump</span>
            <span class="control-key">Space</span>
        </div>
    </div>
    <button class="start-button" onclick="startGame()">Click to Start</button>
</div>

<!-- Loading indicator -->
<div id="loading" class="loading hidden">
    <h2>üåç Generating World</h2>
    <div class="spinner"></div>
    <div class="loading-progress" id="loading-progress">Initializing terrain generator...</div>
</div>

<script>
    // Handle canvas resize
    function resizeCanvas() {
        const canvas = document.getElementById('materia-canvas');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // Prevent context menu on right click
    document.addEventListener('contextmenu', (e) => e.preventDefault());

    // Start game - show loading screen and trigger Kotlin init
    function startGame() {
        console.log('üì± Start button clicked');
        const overlay = document.getElementById('controls-overlay');
        const loading = document.getElementById('loading');

        // Hide controls overlay
        overlay.classList.add('hidden');

        // Show loading screen
        loading.classList.remove('hidden');

        // Mark game as started (prevents controls from showing on ESC)
        gameStarted = true;

        // Trigger Kotlin game initialization
        console.log('üöÄ Calling Kotlin startGameFromButton...');
        if (window.startGameFromButton) {
            window.startGameFromButton();
        } else {
            console.error('‚ùå window.startGameFromButton not found! Kotlin code may not be loaded.');
        }
    }

    // Pointer lock change event
    document.addEventListener('pointerlockchange', lockChangeAlert, false);
    document.addEventListener('mozpointerlockchange', lockChangeAlert, false);
    document.addEventListener('webkitpointerlockchange', lockChangeAlert, false);

    let gameStarted = false;

    function lockChangeAlert() {
        const canvas = document.getElementById('materia-canvas');
        const overlay = document.getElementById('controls-overlay');

        if (document.pointerLockElement === canvas ||
            document.mozPointerLockElement === canvas ||
            document.webkitPointerLockElement === canvas) {
            console.log('Pointer locked');
        } else {
            console.log('Pointer unlocked');
            // Only show controls if game hasn't started yet
            if (!gameStarted) {
                overlay.classList.remove('hidden');
            }
        }
    }

    // Inventory selection
    const inventorySlots = document.querySelectorAll('.inventory-slot');
    inventorySlots.forEach((slot, index) => {
        slot.addEventListener('click', () => {
            inventorySlots.forEach(s => s.classList.remove('selected'));
            slot.classList.add('selected');
        });

        // Number key selection (1-7)
        document.addEventListener('keydown', (e) => {
            if (e.key >= '1' && e.key <= '7') {
                const slotIndex = parseInt(e.key) - 1;
                if (slotIndex < inventorySlots.length) {
                    inventorySlots.forEach(s => s.classList.remove('selected'));
                    inventorySlots[slotIndex].classList.add('selected');
                }
            }
        });
    });

    // FPS Counter
    let frameCount = 0;
    let lastTime = performance.now();

    function updateFPS() {
        frameCount++;
        const currentTime = performance.now();

        if (currentTime - lastTime >= 1000) {
            const fps = Math.round(frameCount * 1000 / (currentTime - lastTime));
            document.getElementById('fps').textContent = fps;
            frameCount = 0;
            lastTime = currentTime;
        }

        requestAnimationFrame(updateFPS);
    }

    updateFPS();
</script>

<!-- Load Kotlin/JS compiled bundle -->
<script src="voxelcraft.js"></script>
</body>
</html>
